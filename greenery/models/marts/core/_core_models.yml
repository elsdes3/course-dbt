version: 2

models:
  - name: fct_orders
    description: aggregated totals for each orderr
    columns:
      - name: order_id
        description: UUID for each unique order on platform
        data_tests:
          - unique
      - name: created_at
        description: Timestamp when the order was created
        data_tests:
          - order_before_delivery:
              field: delivered_at
          - order_before_delivery:
              field: estimated_delivery_at
      - name: state_name
        description: >
            state that the delivery address for this order is based in
        data_tests:
          - not_null
      - name: order_cost
        description: Dollar amout of the items in the order
        data_tests:
          - positive_values
      - name: promo_id
        description: PromoId if any was used in the order
      - name: discount
        description: total discount value from promotions redeemed in order
        data_tests:
          - positive_values
      - name: order_total
        description: Total cost of the order including shipping
        data_tests:
          - positive_values
      - name: total_order_size
        description: >
            Total quantity of all products that were purchased by user
        data_tests:
          - positive_values
      - name: num_unique_products
        description: >
            total number of Greenery platform products that were purchased
            by user
        data_tests:
          - positive_values
      - name: estimated_delivery_at
        description: Estimated timestamp of delivery
      - name: delivered_at
        description: Actual timestamp of delivery
      - name: status
        description: Status of the order
        data_tests:
          - accepted_values:
              values: ['delivered', 'shipped', 'preparing']
      - name: estimated_delivery_time_seconds
        description: >
            estimated time in seconds after placing order until delivery
      - name: delivery_time_seconds
        description: actual time in seconds after placing order until delivery
        data_tests:
          - positive_values
      - name: delivery_delay_seconds
        description: >
            time in seconds between estimated and actual delivery timestamp
        data_tests:
          - positive_values
